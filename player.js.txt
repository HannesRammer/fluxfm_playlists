data:text/javascript;base64,JChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXsNCg0KICAgIGlmIChsb2NhdGlvbi5zZWFyY2ggPT0gIj93aWRnZXQiKSB7DQogICAgICAgICQoIiNwbHRpdGxlIikuaGlkZSgpOw0KICAgICAgICAkKCcjcGxheWxpc3QnKS5oaWRlKCk7DQogICAgICAgIC8vJCgnI25ld3MnKS5oaWRlKCk7DQogICAgfQ0KDQogICAgdmFyIGNoYW5uZWxzID0gW107DQogICAgdmFyIHF1YWxpdGllcyA9IHsNCiAgICAgICAgJ2FhYzY0d2ViJzogJzY0JywNCiAgICAgICAgJ21wMzEyOHdlYic6ICcxMjgnLA0KICAgICAgICAnbXAzMzIwd2ViJzogJzMyMCcNCiAgICB9DQogICAgdmFyIHF1YWxpdHkgPSAnbXAzMTI4d2ViJzsNCg0KICAgIHZhciBwbGF5bGlzdCA9ICcvZmx1eGZtLXBsYXlsaXN0L2FwaS5waHA/YWN0PWxpc3QnOw0KICAgIC8vdmFyIHBsYXlsaXN0ID0gJ3BsYXlsaXN0Lmpzb24/JzsNCg0KICAgIHZhciBjaGFuSXNTbGlkaW5nID0gZmFsc2U7DQogICAgdmFyIGNoYW5Jc0FuaW1hdGluZyA9IGZhbHNlOw0KICAgIHZhciBwbGF5bGlzdEludGVydmFsOw0KDQogICAgLy8gbG9hZCB0ZW1wbGF0ZXMNCiAgICAkKCcjY2hhbm5lbFRhbXBsYXRlJykudGVtcGxhdGUoJ1RwbENoYW5uZWwnKTsNCiAgICAkKCcjcGxheWxpc3RUZW1wbGF0ZScpLnRlbXBsYXRlKCdUcGxQbGF5bGlzdCcpOw0KICAgIC8vJCgnI25ld3NUZW1wbGF0ZScpLnRlbXBsYXRlKCdUcGxOZXdzJyk7DQoNCiAgICAvLyBpbml0aWFsaXplIGpQbGF5ZXINCiAgICAkKCIjalBsYXllciIpLmpQbGF5ZXIoew0KICAgICAgICBzd2ZQYXRoOiAiLi8iLA0KICAgICAgICBzb2x1dGlvbjogImh0bWwsIGZsYXNoIiwNCiAgICAgICAgc3VwcGxpZWQ6ICJtcDMiLA0KICAgICAgICB2b2x1bWU6IDAuNg0KICAgIH0pOw0KDQogICAgLy8gbG9hZCBjaGFubmVsIGxpc3QNCiAgICAkLmdldEpTT04oJy8vZmx1eG11c2ljLmlvL2FwaS9zdHJlYW1zLycpLmRvbmUoZnVuY3Rpb24oZGF0YSl7DQoNCiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGRhdGEuc3RyZWFtcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYoZGF0YS5zdHJlYW1zW2ldLnN0YXRzLndlYnBsYXllcl9pZCA9PSAiIg0KICAgICAgICAgICAgICAgIHx8IGRhdGEuc3RyZWFtc1tpXS5zdGF0cy5sb2MgPT0gIiINCiAgICAgICAgICAgICAgICB8fCBkYXRhLnN0cmVhbXNbaV0udGl0bGUgPT0gIiINCiAgICAgICAgICAgICAgICB8fCBkYXRhLnN0cmVhbXNbaV0uaW1hZ2VzWycxMjh4MTI4J10gPT0gIiINCiAgICAgICAgICAgICAgICB8fCBkYXRhLnN0cmVhbXNbaV0uc291cmNlc1snbXAzMTI4d2ViJ10gPT0gIiINCiAgICAgICAgICAgICAgICB8fCBkYXRhLnN0cmVhbXNbaV0ucHJvZ3JhbSA9PSAiIikgew0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIGNoYW5uZWxzLnB1c2goew0KICAgICAgICAgICAgICAgIG5hbWU6IGRhdGEuc3RyZWFtc1tpXS5zdGF0cy53ZWJwbGF5ZXJfaWQsDQogICAgICAgICAgICAgICAgaW50ZXJuYWw6IGRhdGEuc3RyZWFtc1tpXS5zdGF0cy5sb2MsDQogICAgICAgICAgICAgICAgdGl0bGU6IGRhdGEuc3RyZWFtc1tpXS50aXRsZSwNCiAgICAgICAgICAgICAgICBjb3ZlcjogZGF0YS5zdHJlYW1zW2ldLmltYWdlc1snMTI4eDEyOCddLA0KICAgICAgICAgICAgICAgIHN0cmVhbXM6IGRhdGEuc3RyZWFtc1tpXS5zb3VyY2VzLA0KICAgICAgICAgICAgICAgIHByb2dyYW06IGRhdGEuc3RyZWFtc1tpXS5wcm9ncmFtDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIHNob3cgY2hhbm5lbCBsaXN0DQogICAgICAgICQudG1wbCgiVHBsQ2hhbm5lbCIsIGNoYW5uZWxzKS5hcHBlbmRUbygiI2NoYW5uZWxzc2Nyb2xsZXIgdWwiKTsNCg0KICAgICAgICAvLyBjbGljayBhIGNoYW5uZWwgbG9nbyB0byBzaG93IGNoYW5uZWwgaW5mb3MgYW5kIHBsYXkNCiAgICAgICAgJCgnI2NoYW5uZWxzc2Nyb2xsZXIgYScpLmNsaWNrKGZ1bmN0aW9uKGUpew0KICAgICAgICAgICAgdmFyIGNoYW5uZWwgPSAkKHRoaXMpLmF0dHIoJ3JlbCcpOw0KICAgICAgICAgICAgaWYgKGxvY2F0aW9uLmhhc2ggPT0gJyMnICsgY2hhbm5lbCArICcvcGxheScpIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2hDaGFubmVsKGNoYW5uZWwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBjbGljayB0aGUgY2hhbm5lbCBsb2dvIHRvIGhpZGUgaXQNCiAgICAgICAgJCgnI2NoYW5pbmZvLWNvdmVyJykuY2xpY2soZnVuY3Rpb24oZSl7DQogICAgICAgICAgICBoaWRlQ2hhbkluZm8oKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gc2xpZGUgY2hhbm5lbCBsaXN0IHNpZGV3YXlzIHVzaW5nIGFycm93IGJ1dHRvbnMNCg0KICAgICAgICAkKCcjY2hhbmxlZnQnKS5jbGljayhmdW5jdGlvbihlKXsNCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIGNoYW5zbGlkZSgnbGVmdCcpOw0KICAgICAgICB9KTsNCiAgICAgICAgJCgnI2NoYW5yaWdodCcpLmNsaWNrKGZ1bmN0aW9uKGUpew0KICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgY2hhbnNsaWRlKCdyaWdodCcpOw0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBjbGljayBwbGF5L3N0b3AgYnV0dG9uDQogICAgICAgICQoJyNjb250cm9scy1wbGF5JykuY2xpY2soZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICB2YXIgaGFzaCA9ICcjJyArICQoIiNjaGFubmVscyIpLmZpbmQoImEuYWN0aXZlIikuYXR0cigncmVsJyk7DQogICAgICAgICAgICBpZiAoJCgnI2NvbnRyb2xzLXBsYXknKS5oYXNDbGFzcygic3RvcCIpKSB7DQogICAgICAgICAgICAgICAgbG9jYXRpb24uaGFzaCA9IGhhc2ggKyAnL3BsYXknOw0KICAgICAgICAgICAgICAgIGlmIChuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9tb2JpbGUvaSkpIHsNCiAgICAgICAgICAgICAgICAgICAgcGxheSh0cnVlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGxvY2F0aW9uLmhhc2ggPSBoYXNoOw0KICAgICAgICAgICAgICAgIGlmIChuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9tb2JpbGUvaSkpIHsNCiAgICAgICAgICAgICAgICAgICAgcGxheShmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBjbGljayBwcmV2aW91cy9uZXh0IGJ1dHRvbiB0byBzd2l0Y2ggdG8gb3RoZXIgY2hhbm5lbA0KICAgICAgICAkKCcjY29udHJvbHMtcHJldicpLmNsaWNrKGZ1bmN0aW9uKGUpew0KICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgbmV4dENoYW5uZWwoJ3ByZXYnKTsNCiAgICAgICAgfSk7DQogICAgICAgICQoJyNjb250cm9scy1uZXh0JykuY2xpY2soZnVuY3Rpb24oZSl7DQogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICBuZXh0Q2hhbm5lbCgnbmV4dCcpOw0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBzZXQgdm9sdW1lIGNvbnRyb2wsIGluaXRpYWwgNjAlDQogICAgICAgIHZvbHVtZVNsaWRlcigkKCcjdm9sdW1lJyksIDYwLCBmdW5jdGlvbih2YWx1ZSkgew0KICAgICAgICAgICAgJCgiI2pQbGF5ZXIiKS5qUGxheWVyKCd2b2x1bWUnLCB2YWx1ZSAvIDEwMCk7DQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIHRvZ2dsZSBzdHJlYW0gcXVhbGl0eSBvbiBjbGljaw0KICAgICAgICAkKCcjcXVhbGl0eSBhJykuY2xpY2soZnVuY3Rpb24oZSl7DQogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICB2YXIgZWwgPSAkKHRoaXMpOw0KICAgICAgICAgICAgdmFyIHZhbHVlID0gZWwuYXR0cigncmVsJyk7DQogICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKHF1YWxpdGllcyk7DQogICAgICAgICAgICB2YXIgcG9zID0ga2V5cy5pbmRleE9mKHZhbHVlKTsNCiAgICAgICAgICAgIHZhciBuZXdwb3MgPSAxOyAvLyBkZWZhdWx0ID0gMTI4DQogICAgICAgICAgICBpZiAocG9zID49IDApIHsNCiAgICAgICAgICAgICAgICBuZXdwb3MgPSAocG9zICsgMSkgJSBrZXlzLmxlbmd0aDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNldFF1YWxpdHkoa2V5c1tuZXdwb3NdKTsNCiAgICAgICAgICAgIGlmKGxvY2F0aW9uLmhhc2gubGVuZ3RoID4gMSAmJiAvXC9wbGF5JC8udGVzdChsb2NhdGlvbi5oYXNoKSkgew0KICAgICAgICAgICAgICAgIHBsYXkodHJ1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIHJlYWQgcXVhbGl0eSBzZXR0aW5nIGZyb20gdXNlciBjb29raWUNCiAgICAgICAgdmFyIGtleXZhbHVlID0gZG9jdW1lbnQuY29va2llLm1hdGNoKCcoXnw7KSA/c3RyZWFtcXVhbGl0eT0oW147XSopKDt8JCknKTsNCiAgICAgICAgaWYgKGtleXZhbHVlICYmIHF1YWxpdGllc1trZXl2YWx1ZVsyXV0gIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBzZXRRdWFsaXR5KGtleXZhbHVlWzJdKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIHNldHVwIG5ld3MgZmVlZA0KICAgICAgICAvL2xvYWRSU1NmZWVkKCcvZmVlZC8nKTsNCg0KICAgICAgICAvLyBpbml0aWFsaXplIHBsYXllciBhbmQgY2hvb3NlIGNoYW5uZWwNCiAgICAgICAgaW5pdFBsYXllcigpOw0KICAgICAgICByZXN0YXJ0UGxheWxpc3QoKTsNCg0KICAgICAgICAvLyBsaXN0ZW4gZm9yIGhhc2ggdGFnOyBjaGFubmVsIHN3aXRjaGluZyBhbmQgcGxheS9zdG9wIHdvcmtzIHRoaXMgd2F5IQ0KICAgICAgICAkKHdpbmRvdykub24oJ2hhc2hjaGFuZ2UnLCBpbml0UGxheWVyKTsNCg0KICAgIH0pDQogICAgICAgIC5mYWlsKGZ1bmN0aW9uKCl7DQoNCiAgICAgICAgfSk7DQoNCg0KDQogICAgLy8gc2xpZGUgY2hhbm5lbCBsaXN0IHNpZGV3YXlzIHVzaW5nIHNjcm9sbExlZnQNCiAgICBmdW5jdGlvbiBjaGFuc2xpZGUoZGlyZWN0aW9uKSB7DQogICAgICAgIGlmIChjaGFuSXNTbGlkaW5nKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgY2hhbklzU2xpZGluZyA9IHRydWU7DQogICAgICAgIHZhciBjaGFubGlzdCA9ICQoJyNjaGFubmVsc3Njcm9sbGVyJyk7DQogICAgICAgIHZhciBsZWZ0ID0gY2hhbmxpc3Quc2Nyb2xsTGVmdCgpOw0KICAgICAgICAvLyByZWFjaGVkIHRoZSBlbmQ/IChuZWVkIHRvIGNoZWNrIGl0IGluIEZpcmVmb3gpDQogICAgICAgIC8vaWYgKGRpcmVjdGlvbiA9PSAncmlnaHQnICYmIChjaGFubmVscy5sZW5ndGggLSAzKSAqIDkwIDw9IGxlZnQpIHsNCiAgICAgICAgLy8JY2hhbklzU2xpZGluZyA9IGZhbHNlOw0KICAgICAgICAvLwlyZXR1cm47DQogICAgICAgIC8vfQ0KICAgICAgICB2YXIgcmVtYWluZGVyID0gbGVmdCAlIDkwOw0KICAgICAgICBpZiAoZGlyZWN0aW9uID09ICdsZWZ0Jykgew0KICAgICAgICAgICAgaWYgKHJlbWFpbmRlciA+IDApIHsNCiAgICAgICAgICAgICAgICBsZWZ0ID0gbGVmdCAtIHJlbWFpbmRlcjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbGVmdCAtPSA5MDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChyZW1haW5kZXIgPiAwKSB7DQogICAgICAgICAgICAgICAgbGVmdCA9IGxlZnQgKyA5MCAtIHJlbWFpbmRlcjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbGVmdCArPSA5MDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjaGFubGlzdC5hbmltYXRlKHsNCiAgICAgICAgICAgIHNjcm9sbExlZnQ6IGxlZnQNCiAgICAgICAgfSwgMTAwLCAnc3dpbmcnLCBmdW5jdGlvbigpew0KICAgICAgICAgICAgY2hhbklzU2xpZGluZyA9IGZhbHNlOw0KICAgICAgICB9KTsNCiAgICB9DQoNCiAgICAvLyBpZiBhIGNoYW5uZWwgaXNuJ3QgaW4gdmlldywgc2Nyb2xsIHRvIGl0DQogICAgZnVuY3Rpb24gc2Nyb2xsVG9DaGFubmVsKGNoYW5uZWwsIGNhbGxiYWNrKSB7DQogICAgICAgIGlmIChjaGFuSXNTbGlkaW5nKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgY2hhbklzU2xpZGluZyA9IHRydWU7DQogICAgICAgIHZhciBjaGFubGlzdCA9ICQoJyNjaGFubmVsc3Njcm9sbGVyJyk7DQogICAgICAgIHZhciBjaGFuID0gJCgnI2NoYW5uZWxzJykuZmluZCgnW3JlbD0iJytjaGFubmVsKyciXScpOw0KICAgICAgICB2YXIgbGVmdCA9IGNoYW4ub2Zmc2V0KCkubGVmdCAtIGNoYW5saXN0Lm9mZnNldCgpLmxlZnQ7DQogICAgICAgIHZhciByaWdodCA9IGNoYW4ub2Zmc2V0KCkubGVmdCAtIGNoYW5saXN0Lm9mZnNldCgpLmxlZnQgKyA5MCAtIGNoYW5saXN0LndpZHRoKCk7DQogICAgICAgIHZhciBzY3JvbGxsZWZ0ID0gMDsNCiAgICAgICAgaWYgKGxlZnQgPD0gMCkgew0KICAgICAgICAgICAgLy8gbG9nbyBpc3QgbmljaHQgc2ljaHRiYXIsIHNpY2h0YmFyIG1hY2hlbg0KICAgICAgICAgICAgc2Nyb2xsbGVmdCA9IGNoYW5saXN0LnNjcm9sbExlZnQoKSArIGxlZnQ7DQogICAgICAgIH0gZWxzZSBpZiAocmlnaHQgPiAwKSB7DQogICAgICAgICAgICBzY3JvbGxsZWZ0ID0gY2hhbmxpc3Quc2Nyb2xsTGVmdCgpICsgcmlnaHQ7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGxlZnQgPD0gMCB8fCByaWdodCA+IDApIHsNCiAgICAgICAgICAgIGNoYW5saXN0LmFuaW1hdGUoew0KICAgICAgICAgICAgICAgIHNjcm9sbExlZnQ6IHNjcm9sbGxlZnQNCiAgICAgICAgICAgIH0sIDEwMCwgJ3N3aW5nJywgZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICAgICBjYWxsYmFjaygpOw0KICAgICAgICAgICAgICAgIGNoYW5Jc1NsaWRpbmcgPSBmYWxzZTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9IGVsc2UgaWYoY2FsbGJhY2sgIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBjYWxsYmFjaygpOw0KICAgICAgICAgICAgY2hhbklzU2xpZGluZyA9IGZhbHNlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8gaGlkZSBjaGFubmVsIGluZm8NCiAgICBmdW5jdGlvbiBoaWRlQ2hhbkluZm8oY2FsbGJhY2spIHsNCiAgICAgICAgdmFyIGxlZnQgPSAkKCcjY2hhbmluZm8tY292ZXInKS5hdHRyKCdkYXRhLWxlZnQnKTsNCiAgICAgICAgdmFyIGNvdmVyID0gJCgnI2NoYW5pbmZvLWNvdmVyIGltZycpLmF0dHIoJ3NyYycpOw0KICAgICAgICBpZiAobGVmdCA9PSAwKSB7DQogICAgICAgICAgICAkKCcjY2hhbmluZm8nKS5oaWRlKCk7DQogICAgICAgICAgICAkKCcjY2hhbnNlbGVjdG9yJykuc2hvdygpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdmFyIGxvZ28gPSAkKCcjY2hhbmxvZ28nKQ0KICAgICAgICAgICAgICAgIC5hdHRyKCdzcmMnLCBjb3ZlcikNCiAgICAgICAgICAgICAgICAuY3NzKCdsZWZ0JywgMCkNCiAgICAgICAgICAgICAgICAuc2hvdygpOw0KICAgICAgICAgICAgJCgnI2NoYW5pbmZvJykuZmFkZU91dCgxMDApOw0KICAgICAgICAgICAgbG9nby5hbmltYXRlKHsNCiAgICAgICAgICAgICAgICBsZWZ0OiAobGVmdC0yNSkrJ3B4Jw0KICAgICAgICAgICAgfSwgMjAwLCAnc3dpbmcnLCBmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgICQoJyNjaGFuc2VsZWN0b3InKS5mYWRlSW4oMTAwLCBmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgICAgICBsb2dvLmhpZGUoKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBzd2l0Y2ggdG8gYW5vdGhlciBjaGFubmVsOyBpbmNsdWRlcyBhbmltYXRpb25zDQogICAgZnVuY3Rpb24gc3dpdGNoQ2hhbm5lbChjaGFubmVsLCBjYWxsYmFjaykgew0KICAgICAgICBpZiAoY2hhbklzQW5pbWF0aW5nKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgY2hhbklzQW5pbWF0aW5nID0gdHJ1ZTsNCiAgICAgICAgdmFyIGNoYW4gPSAkKCcjY2hhbm5lbHNzY3JvbGxlciBhLmFjdGl2ZScpOw0KICAgICAgICB2YXIgY2hhbmluZm8gPSAkKCcjY2hhbmluZm8nKTsNCiAgICAgICAgaWYgKGNoYW4uYXR0cigncmVsJykgPT0gY2hhbm5lbCAmJiBjaGFuaW5mby5pcygnOnZpc2libGUnKSkgew0KICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjaGFuSXNBbmltYXRpbmcgPSBmYWxzZTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgY2hhbnNlbGVjdG9yID0gJCgnI2NoYW5zZWxlY3RvcicpOw0KDQogICAgICAgIGlmIChjaGFuaW5mby5pcygnOnZpc2libGUnKSkgew0KICAgICAgICAgICAgaGlkZUNoYW5JbmZvKGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgc2Nyb2xsVG9DaGFubmVsKGNoYW5uZWwsIGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgICAgIHNldENoYW5uZWxBY3RpdmUoY2hhbm5lbCk7DQogICAgICAgICAgICAgICAgICAgIHNob3dDaGFuSW5mbyhjaGFubmVsLCBmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBjaGFuSXNBbmltYXRpbmcgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNjcm9sbFRvQ2hhbm5lbChjaGFubmVsLCBmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgIHNldENoYW5uZWxBY3RpdmUoY2hhbm5lbCk7DQogICAgICAgICAgICAgICAgc2hvd0NoYW5JbmZvKGNoYW5uZWwsIGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2hhbklzQW5pbWF0aW5nID0gZmFsc2U7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vIHNldHMgYSBjaGFubmVsIGFjdGl2ZQ0KICAgIGZ1bmN0aW9uIHNldENoYW5uZWxBY3RpdmUoY2hhbm5lbCkgew0KICAgICAgICAkKCcjY2hhbm5lbHNzY3JvbGxlciBhLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCiAgICAgICAgJCgnI2NoYW5uZWxzJykuZmluZCgnW3JlbD0iJytjaGFubmVsKyciXScpLmFkZENsYXNzKCdhY3RpdmUnKTsNCiAgICB9DQoNCiAgICAvLyBzaG93cyBjaGFubmVsIGluZm9zDQogICAgZnVuY3Rpb24gc2hvd0NoYW5JbmZvKGNoYW5uZWwsIGNhbGxiYWNrKSB7DQogICAgICAgIHZhciBjaGFuaW5mbyA9IGdldENoYW5JbmZvKGNoYW5uZWwpOw0KICAgICAgICB2YXIgY2hhbiA9ICQoJyNjaGFubmVscycpLmZpbmQoJ1tyZWw9IicrY2hhbm5lbCsnIl0nKTsNCiAgICAgICAgdmFyIHBvc0xlZnQgPSBjaGFuLnByb3AoJ29mZnNldExlZnQnKSAtICQoJyNjaGFubmVsc3Njcm9sbGVyJykuc2Nyb2xsTGVmdCgpOw0KDQogICAgICAgIHNldENoYW5JbmZvKGNoYW5pbmZvLCBwb3NMZWZ0ICsgMjUpOw0KDQogICAgICAgIHZhciBsb2dvID0gJCgnI2NoYW5sb2dvJyk7DQogICAgICAgIGxvZ28NCiAgICAgICAgICAgIC5hdHRyKCdzcmMnLCBjaGFuaW5mby5jb3ZlcikNCiAgICAgICAgICAgIC5jc3MoJ2xlZnQnLCAocG9zTGVmdCkgKyAncHgnKQ0KICAgICAgICAgICAgLnNob3coKTsNCg0KICAgICAgICAkKCcjY2hhbnNlbGVjdG9yJykuZmFkZU91dCgxMDAsIGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAkKHRoaXMpLmhpZGUoKTsNCiAgICAgICAgfSk7DQogICAgICAgIGxvZ28uYW5pbWF0ZSh7DQogICAgICAgICAgICBsZWZ0OiAwDQogICAgICAgIH0sIDIwMCwgJ3N3aW5nJywgZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICQoJyNjaGFuaW5mbycpLmZhZGVJbigxMDAsIGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgbG9nby5oaWRlKCk7DQogICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICB9DQoNCiAgICAvLyBzd2l0Y2hlcyB0byBwcmV2aW91cyBvciBuZXh0IGNoYW5uZWwNCiAgICBmdW5jdGlvbiBuZXh0Q2hhbm5lbChkaXJlY3Rpb24pIHsNCiAgICAgICAgaWYgKGNoYW5Jc0FuaW1hdGluZykgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHZhciBlbCA9ICQoJyNjaGFubmVscycpLmZpbmQoJ2EuYWN0aXZlJykucGFyZW50KCk7DQogICAgICAgIGlmIChkaXJlY3Rpb24gPT0gJ3ByZXYnKSB7DQogICAgICAgICAgICBlbCA9IGVsLnByZXYoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGVsID0gZWwubmV4dCgpOw0KICAgICAgICB9DQogICAgICAgIGVsID0gZWwuZmluZCgnYScpOw0KICAgICAgICBpZiAoZWwubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgY2hhbm5lbCA9IGVsLmF0dHIoJ3JlbCcpOw0KICAgICAgICB2YXIgaGFzaCA9ICcjJyArIGNoYW5uZWw7DQogICAgICAgIGlmICgvXC9wbGF5JC8udGVzdChsb2NhdGlvbi5oYXNoKSkgew0KICAgICAgICAgICAgaGFzaCArPSAnL3BsYXknOw0KICAgICAgICAgICAgaWYgKG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL21vYmlsZS9pKSkgew0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICAgICAgICAgcGxheSh0cnVlKTsNCiAgICAgICAgICAgICAgICB9LCAzMTApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGxvY2F0aW9uLmhhc2ggPSBoYXNoOw0KICAgIH0NCg0KICAgIC8vIHN0YXJ0IG9yIHN0b3AgcGxheWJhY2sNCiAgICBmdW5jdGlvbiBwbGF5KHBsYXkpIHsNCiAgICAgICAgaWYgKHBsYXkgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgaWYoJCgiI2NvbnRyb2xzLXBsYXkiKS5oYXNDbGFzcygic3RvcCIpKSB7DQogICAgICAgICAgICAgICAgcGxheSA9IHRydWU7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHBsYXkgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAocGxheSkgew0KICAgICAgICAgICAgdmFyIGNoYW5uZWwgPSAkKCcjY2hhbm5lbHNzY3JvbGxlciBhLmFjdGl2ZScpLmF0dHIoJ3JlbCcpOw0KICAgICAgICAgICAgdmFyIGNoYW5pbmZvID0gZ2V0Q2hhbkluZm8oY2hhbm5lbCk7DQogICAgICAgICAgICB2YXIgbWVkaWEgPSB7IG1wMzogY2hhbmluZm8uc3RyZWFtc1txdWFsaXR5XSB9Ow0KICAgICAgICAgICAgLy9pZiAoL2FhYy9pLnRlc3QoY2hhbmluZm8uc3RyZWFtc1txdWFsaXR5XSkpIHsNCiAgICAgICAgICAgIC8vCW1lZGlhID0geyBtcDM6IGNoYW5pbmZvLnN0cmVhbXNbcXVhbGl0eV0gfTsNCiAgICAgICAgICAgIC8vfQ0KDQogICAgICAgICAgICAkKCIjalBsYXllciIpDQogICAgICAgICAgICAgICAgLmpQbGF5ZXIoInNldE1lZGlhIiwgbWVkaWEpDQogICAgICAgICAgICAgICAgLmpQbGF5ZXIoJ3BsYXknKTsNCiAgICAgICAgICAgICQoIiNjb250cm9scy1wbGF5IikNCiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ3N0b3AnKQ0KICAgICAgICAgICAgICAgIC5hZGRDbGFzcygncGxheScpDQogICAgICAgICAgICAgICAgLmZpbmQoJ2ltZycpDQogICAgICAgICAgICAgICAgLmF0dHIoJ3NyYycsICdpbWFnZXMvc3RvcC5wbmcnKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICQoIiNqUGxheWVyIikualBsYXllcignY2xlYXJNZWRpYScpOw0KICAgICAgICAgICAgJCgiI2NvbnRyb2xzLXBsYXkiKQ0KICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygncGxheScpDQogICAgICAgICAgICAgICAgLmFkZENsYXNzKCdzdG9wJykNCiAgICAgICAgICAgICAgICAuZmluZCgnaW1nJykNCiAgICAgICAgICAgICAgICAuYXR0cignc3JjJywgJ2ltYWdlcy9wbGF5LnBuZycpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2V0UXVhbGl0eSh2YWx1ZSkgew0KICAgICAgICAvL3ZhciBjaGFubmVsID0gJCgnI2NoYW5uZWxzc2Nyb2xsZXIgYS5hY3RpdmUnKS5hdHRyKCdyZWwnKTsNCiAgICAgICAgLy9pZiAodHlwZW9mIGNoYW5uZWwgIT09ICdzdHJpbmcnKSB7DQogICAgICAgIC8vCXJldHVybjsNCiAgICAgICAgLy99DQogICAgICAgIC8vdmFyIGNoYW5pbmZvID0gZ2V0Q2hhbkluZm8oY2hhbm5lbCk7DQogICAgICAgIC8vaWYgKGNoYW5pbmZvLnN0cmVhbXNbdmFsdWVdID09IHVuZGVmaW5lZCkgew0KICAgICAgICAvLwlyZXR1cm47DQogICAgICAgIC8vfQ0KICAgICAgICBpZiAocXVhbGl0aWVzW3ZhbHVlXSA9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBxdWFsaXR5ID0gdmFsdWU7DQoNCiAgICAgICAgJCgnI3F1YWxpdHkgYScpDQogICAgICAgICAgICAuYXR0cigncmVsJywgdmFsdWUpDQogICAgICAgICAgICAudGV4dChxdWFsaXRpZXNbdmFsdWVdKTsNCg0KICAgICAgICAvLyBzZXQgcXVhbGl0eSBzZXR0aW5nIGNvb2tpZQ0KICAgICAgICB2YXIgZXhwaXJlcyA9IG5ldyBEYXRlKCk7DQogICAgICAgIGV4cGlyZXMuc2V0VGltZShleHBpcmVzLmdldFRpbWUoKSArICgxICogMjQgKiA2MCAqIDYwICogMTAwMCkpOw0KICAgICAgICBkb2N1bWVudC5jb29raWUgPSAnc3RyZWFtcXVhbGl0eT0nICsgcXVhbGl0eSArICc7cGF0aD0vc3RyZWFtLztleHBpcmVzPScgKyBleHBpcmVzLnRvVVRDU3RyaW5nKCk7DQogICAgfQ0KDQogICAgLy8gc2V0dXAgY2hhbm5lbDsgZmlyZWQgb24gZXZlcnkgaGFzaCBjaGFuZ2UNCiAgICBmdW5jdGlvbiBpbml0UGxheWVyKCkgew0KICAgICAgICBpZihsb2NhdGlvbi5oYXNoLmxlbmd0aCA+IDEpIHsNCiAgICAgICAgICAgIHZhciBwYXJhbXMgPSBsb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKS5zcGxpdCgiLyIpOw0KICAgICAgICAgICAgaWYgKGdldENoYW5JbmZvKHBhcmFtc1swXSkgPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICBzZXRDaGFubmVsQWN0aXZlKGNoYW5uZWxzWzBdLm5hbWUpOw0KICAgICAgICAgICAgICAgIHNldFN0YXRpb24oY2hhbm5lbHNbMF0ubmFtZSk7DQogICAgICAgICAgICAgICAgcGxheShmYWxzZSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc3dpdGNoQ2hhbm5lbChwYXJhbXNbMF0sIGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgc2V0U3RhdGlvbihwYXJhbXNbMF0pOw0KICAgICAgICAgICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID4gMSAmJiBwYXJhbXNbMV0gPT0gJ3BsYXknKSB7DQogICAgICAgICAgICAgICAgICAgIHBsYXkodHJ1ZSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcGxheShmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBzZXRDaGFubmVsQWN0aXZlKGNoYW5uZWxzWzBdLm5hbWUpOw0KICAgICAgICAgICAgc2V0U3RhdGlvbihjaGFubmVsc1swXS5uYW1lKTsNCiAgICAgICAgICAgIHBsYXkoZmFsc2UpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLy8gZ2V0cyBjaGFubmVsIGluZm8NCiAgICBmdW5jdGlvbiBnZXRDaGFuSW5mbyhjaGFubmVsKSB7DQogICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBjaGFubmVscy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKGNoYW5uZWxzW2ldLm5hbWUgPT0gY2hhbm5lbCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBjaGFubmVsc1tpXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgLy8gc2V0cyBjaGFubmVsIGluZm8gZGlhbG9nDQogICAgZnVuY3Rpb24gc2V0Q2hhbkluZm8oY2hhbmluZm8sIHBvcykgew0KDQogICAgICAgICQoJyNjaGFuaW5mby1jb3ZlciBpbWcnKS5hdHRyKCdzcmMnLCBjaGFuaW5mby5jb3Zlcik7DQogICAgICAgICQoJyNjaGFuaW5mby1jb3ZlcicpLmF0dHIoJ2RhdGEtbGVmdCcsIHBvcyk7DQoNCiAgICAgICAgJC5nZXRKU09OKGNoYW5pbmZvLnByb2dyYW0pLmRvbmUoZnVuY3Rpb24oZGF0YSl7DQogICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTsNCiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBkYXRhLnByb2dyYW0ubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICBpZiAoZGF0YS5wcm9ncmFtW2ldLnN0YXJ0X3RpbWVzdGFtcCA8IGRhdGEubm93X3RpbWVzdGFtcCAmJiBkYXRhLnByb2dyYW1baV0uZW5kX3RpbWVzdGFtcCA+IGRhdGEubm93X3RpbWVzdGFtcCkgew0KICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICQoJyNjaGFuaW5mby10aW1lJykNCiAgICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KGRhdGEucHJvZ3JhbVtpXS5zdGFydF90aW1lICsgIi0iICsgZGF0YS5wcm9ncmFtW2ldLmVuZF90aW1lKQ0KICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoInRpdGxlIiwgZGF0YS5wcm9ncmFtW2ldLnN0YXJ0X3RpbWUgKyAiLSIgKyBkYXRhLnByb2dyYW1baV0uZW5kX3RpbWUpOw0KICAgICAgICAgICAgICAgICAgICAkKCcjY2hhbmluZm8tdGl0bGUnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQoZGF0YS5wcm9ncmFtW2ldLnRpdGxlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoInRpdGxlIiwgZGF0YS5wcm9ncmFtW2ldLnRpdGxlKTsNCiAgICAgICAgICAgICAgICAgICAgJCgnI2NoYW5pbmZvLWRlc2MnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQoZGF0YS5wcm9ncmFtW2ldLmV4Y2VycHQpDQogICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigidGl0bGUiLCBkYXRhLnByb2dyYW1baV0uZXhjZXJwdCk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghZm91bmQpIHsNCiAgICAgICAgICAgICAgICAkKCcjY2hhbmluZm8tdGltZScpDQogICAgICAgICAgICAgICAgICAgIC50ZXh0KCIiKQ0KICAgICAgICAgICAgICAgICAgICAuYXR0cigidGl0bGUiLCAiIik7DQogICAgICAgICAgICAgICAgJCgnI2NoYW5pbmZvLXRpdGxlJykNCiAgICAgICAgICAgICAgICAgICAgLnRleHQoIiIpDQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJ0aXRsZSIsICIiKTsNCiAgICAgICAgICAgICAgICAkKCcjY2hhbmluZm8tZGVzYycpDQogICAgICAgICAgICAgICAgICAgIC50ZXh0KCIiKQ0KICAgICAgICAgICAgICAgICAgICAuYXR0cigidGl0bGUiLCAiIik7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgfQ0KDQogICAgLy8gc3RyZWFtIGFuZCB1cGRhdGUgcGxheWxpc3QNCiAgICBmdW5jdGlvbiBzZXRTdGF0aW9uKHN0YXRpb24pIHsNCiAgICAgICAgdmFyIGNoYW5pbmZvID0gZ2V0Q2hhbkluZm8oc3RhdGlvbik7DQogICAgICAgIC8vJCgnI2pQbGF5ZXInKS5qUGxheWVyKCdzZXRNZWRpYScsIHsNCiAgICAgICAgLy8JbXAzOiBjaGFuaW5mby5zdHJlYW1zW3F1YWxpdHldDQogICAgICAgIC8vfSk7DQogICAgICAgICQoJyNwbHRpdGxlJykudGV4dChjaGFuaW5mby50aXRsZSArICIgLSBadWxldHp0IGdlc3BpZWx0Iik7DQogICAgICAgIHJlc3RhcnRQbGF5bGlzdCgpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHJlc3RhcnRQbGF5bGlzdCgpIHsNCiAgICAgICAgY2xlYXJJbnRlcnZhbChwbGF5bGlzdEludGVydmFsKTsNCiAgICAgICAgdXBkYXRlUGxheWxpc3QoKTsNCiAgICAgICAgcGxheWxpc3RJbnRlcnZhbCA9IHNldEludGVydmFsKHVwZGF0ZVBsYXlsaXN0LCAzMDAwMCk7DQogICAgfQ0KICAgIC8vIGxvYWRzIHBsYXlsaXN0IGRhdGENCiAgICAvLyB3aGl0ZTogaHR0cDovL2VjeC5pbWFnZXMtYW1hem9uLmNvbS9pbWFnZXMvSS82MUU2SzhNSXFPTC5fU0wzMjBfLmpwZw0KICAgIGZ1bmN0aW9uIHVwZGF0ZVBsYXlsaXN0KCkgew0KICAgICAgICB2YXIgY2hhbm5lbCA9ICQoJyNjaGFubmVsc3Njcm9sbGVyIGEuYWN0aXZlJykuYXR0cigncmVsJyk7DQogICAgICAgIGlmICh0eXBlb2YgY2hhbm5lbCAhPT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgY2hhbmluZm8gPSBnZXRDaGFuSW5mbyhjaGFubmVsKTsNCiAgICAgICAgJC5hamF4KHsNCiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsDQogICAgICAgICAgICB1cmw6IHBsYXlsaXN0ICsgJyZsb2M9JyArIGNoYW5pbmZvLmludGVybmFsICsgJyZjdXR0aW1lPTEmbGltaXQ9NCcsDQogICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7DQogICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzICE9ICJvayIpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkKCcjdHJhY2stYXJ0aXN0JykudGV4dChkYXRhLnRyYWNrc1swXS5hcnRpc3QpOw0KICAgICAgICAgICAgICAgICQoJyN0cmFjay10aXRsZScpLnRleHQoZGF0YS50cmFja3NbMF0udGl0bGUpOw0KICAgICAgICAgICAgICAgICQoJyN0cmFjay1hbGJ1bScpLnRleHQoZGF0YS50cmFja3NbMF0uYWxidW0pOw0KICAgICAgICAgICAgICAgIGlmIChkYXRhLnRyYWNrc1swXS5jb3ZlcnVybCA9PSAiIiB8fCBkYXRhLnRyYWNrc1swXS5jb3ZlcnVybCA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgICQoJyNjb3ZlcicpLmF0dHIoJ3NyYycsICJpbWFnZXMvY292ZXIucG5nIik7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjb3ZlcicpLmF0dHIoJ3NyYycsIGRhdGEudHJhY2tzWzBdLmNvdmVydXJsLnJlcGxhY2UoL1NMNzVfXC5qcGckLywgJ1NMMzIwXy5qcGcnKSk7DQoNCg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkKCIjcGxpc3QiKS5odG1sKCIiKTsNCiAgICAgICAgICAgICAgICAkLnRtcGwoIlRwbFBsYXlsaXN0IiwgZGF0YS50cmFja3MpLmFwcGVuZFRvKCIjcGxsaXN0Iik7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIC8vIHNldHVwIHZvbHVtZSBzbGlkZXINCiAgICBmdW5jdGlvbiB2b2x1bWVTbGlkZXIoc2xpZGVyLCBkZWZhdWx0VmFsdWUsIG9uRHJhZykgew0KDQogICAgICAgIHZhciBkcmFnZ2VyID0gc2xpZGVyLmNoaWxkcmVuKCk7DQogICAgICAgIHZhciBkcmFnZ2VyV2lkdGggPSA0Ow0KICAgICAgICB2YXIgZG93biA9IGZhbHNlOw0KICAgICAgICB2YXIgcmFuZ2VXaWR0aCwgcmFuZ2VMZWZ0Ow0KDQogICAgICAgIGRyYWdnZXIuY3NzKCd3aWR0aCcsIGRyYWdnZXJXaWR0aCArICdweCcpOw0KICAgICAgICBkcmFnZ2VyLmNzcygnbGVmdCcsICgtZHJhZ2dlcldpZHRoICsgc2xpZGVyLndpZHRoKCkgKiBkZWZhdWx0VmFsdWUgLyAxMDApICsgJ3B4Jyk7DQogICAgICAgIGRyYWdnZXIuY3NzKCdtYXJnaW4tbGVmdCcsIChkcmFnZ2VyV2lkdGggLyAyKSArICdweCcpOw0KDQogICAgICAgIHNsaWRlci5tb3VzZWRvd24oZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgcmFuZ2VXaWR0aCA9IHRoaXMub2Zmc2V0V2lkdGg7DQogICAgICAgICAgICByYW5nZUxlZnQgPSB0aGlzLm9mZnNldExlZnQ7DQogICAgICAgICAgICBkb3duID0gdHJ1ZTsNCiAgICAgICAgICAgIHVwZGF0ZURyYWdnZXIoZSk7DQogICAgICAgIH0pOw0KDQogICAgICAgICQoZG9jdW1lbnQpLm1vdXNlbW92ZShmdW5jdGlvbihlKSB7DQogICAgICAgICAgICB1cGRhdGVEcmFnZ2VyKGUpOw0KICAgICAgICB9KTsNCg0KICAgICAgICAkKGRvY3VtZW50KS5tb3VzZXVwKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgZG93biA9IGZhbHNlOw0KICAgICAgICB9KTsNCg0KICAgICAgICBmdW5jdGlvbiB1cGRhdGVEcmFnZ2VyKGUpIHsNCiAgICAgICAgICAgIGlmIChkb3duICYmIGUucGFnZVggPj0gcmFuZ2VMZWZ0ICYmIGUucGFnZVggPD0gKHJhbmdlTGVmdCArIHJhbmdlV2lkdGgpKSB7DQogICAgICAgICAgICAgICAgZHJhZ2dlci5jc3MoJ2xlZnQnLCBlLnBhZ2VYIC0gcmFuZ2VMZWZ0IC0gZHJhZ2dlcldpZHRoICsgJ3B4Jyk7DQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvbkRyYWcgPT0gImZ1bmN0aW9uIikgew0KICAgICAgICAgICAgICAgICAgICBvbkRyYWcoTWF0aC5yb3VuZCgoKGUucGFnZVggLSByYW5nZUxlZnQpIC8gcmFuZ2VXaWR0aCkgKiAxMDApKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgIH0NCg0KICAgIC8vIFJTUyBmZWVkDQogICAgLyoNCiAgICBmdW5jdGlvbiBsb2FkUlNTZmVlZChyc3N1cmwpIHsNCiAgICAgICAgJC5nZXQocnNzdXJsLCBmdW5jdGlvbihkYXRhKSB7DQogICAgICAgICAgICB2YXIgJHhtbCA9ICQoZGF0YSk7DQogICAgICAgICAgICB2YXIgaXRlbXMgPSBbXTsNCiAgICAgICAgICAgIHZhciBpID0gMDsNCiAgICAgICAgICAgICR4bWwuZmluZCgiaXRlbSIpLmVhY2goZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgaWYgKGkrKzw1KSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTsNCiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IHsNCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICR0aGlzLmZpbmQoInRpdGxlIikudGV4dCgpLA0KICAgICAgICAgICAgICAgICAgICBsaW5rOiAkdGhpcy5maW5kKCJsaW5rIikudGV4dCgpLA0KICAgICAgICAgICAgICAgICAgICBjb250ZW50U25pcHBldDogJHRoaXMuZmluZCgiZGVzY3JpcHRpb24iKS50ZXh0KCkucmVwbGFjZSgvPGltZy4qPz4vLCAnJyksDQogICAgICAgICAgICAgICAgICAgIC8vcHViRGF0ZTogJHRoaXMuZmluZCgicHViRGF0ZSIpLnRleHQoKSwNCiAgICAgICAgICAgICAgICAgICAgLy9hdXRob3I6ICR0aGlzLmZpbmQoImF1dGhvciIpLnRleHQoKQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgaXRlbXMucHVzaChpdGVtKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgJC50bXBsKCJUcGxOZXdzIiwgaXRlbXMpLnByZXBlbmRUbygiI25ld3NsaXN0Iik7DQogICAgICAgIH0pOw0KICAgIH0NCiAgICAqLw0KDQp9KTsNCg==