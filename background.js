// match pattern for the URLs to redirect
var pattern = "*://www.fluxfm.de/stream/player.js*";
debugger;
// redirect function
// returns an object with a property `redirectURL`
// set to the new URL
function redirect(requestDetails) {
    console.log("Redirecting: " + requestDetails.url);
   // debugger;
    return {
        //redirectUrl: 'data:text/html' +encodeURIComponent(jsPlayer)
        redirectUrl: datatext
    };
}

// add the listener,
// passing the filter argument and "blocking"
chrome.webRequest.onBeforeRequest.addListener(
    redirect,
    {urls:[pattern]},
    ["blocking"]
);

let datatext = 'data:text/javascript;base64,JChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXsKCiAgICBpZiAobG9jYXRpb24uc2VhcmNoID09ICI/d2lkZ2V0IikgewogICAgICAgICQoIiNwbHRpdGxlIikuaGlkZSgpOwogICAgICAgICQoJyNwbGF5bGlzdCcpLmhpZGUoKTsKICAgICAgICAvLyQoJyNuZXdzJykuaGlkZSgpOwogICAgfQoKICAgIHZhciBjaGFubmVscyA9IFtdOwogICAgdmFyIHF1YWxpdGllcyA9IHsKICAgICAgICAnYWFjNjR3ZWInOiAnNjQnLAogICAgICAgICdtcDMxMjh3ZWInOiAnMTI4JywKICAgICAgICAnbXAzMzIwd2ViJzogJzMyMCcKICAgIH0KICAgIHZhciBxdWFsaXR5ID0gJ21wMzEyOHdlYic7CgogICAgdmFyIHBsYXlsaXN0ID0gJy9mbHV4Zm0tcGxheWxpc3QvYXBpLnBocD9hY3Q9bGlzdCc7CiAgICAvL3ZhciBwbGF5bGlzdCA9ICdwbGF5bGlzdC5qc29uPyc7CgogICAgdmFyIGNoYW5Jc1NsaWRpbmcgPSBmYWxzZTsKICAgIHZhciBjaGFuSXNBbmltYXRpbmcgPSBmYWxzZTsKICAgIHZhciBwbGF5bGlzdEludGVydmFsOwoKICAgIC8vIGxvYWQgdGVtcGxhdGVzCiAgICAkKCcjY2hhbm5lbFRhbXBsYXRlJykudGVtcGxhdGUoJ1RwbENoYW5uZWwnKTsKICAgICQoJyNwbGF5bGlzdFRlbXBsYXRlJykudGVtcGxhdGUoJ1RwbFBsYXlsaXN0Jyk7CiAgICAvLyQoJyNuZXdzVGVtcGxhdGUnKS50ZW1wbGF0ZSgnVHBsTmV3cycpOwoKICAgIC8vIGluaXRpYWxpemUgalBsYXllcgogICAgJCgiI2pQbGF5ZXIiKS5qUGxheWVyKHsKICAgICAgICBzd2ZQYXRoOiAiLi8iLAogICAgICAgIHNvbHV0aW9uOiAiaHRtbCwgZmxhc2giLAogICAgICAgIHN1cHBsaWVkOiAibXAzIiwKICAgICAgICB2b2x1bWU6IDAuNgogICAgfSk7CgogICAgLy8gbG9hZCBjaGFubmVsIGxpc3QKICAgICQuZ2V0SlNPTignaHR0cHM6Ly9mbHV4bXVzaWMuaW8vYXBpL3N0cmVhbXMvJykuZG9uZShmdW5jdGlvbihkYXRhKXsKCiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGRhdGEuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZihkYXRhLnN0cmVhbXNbaV0uc3RhdHMud2VicGxheWVyX2lkID09ICIiCiAgICAgICAgICAgICAgICB8fCBkYXRhLnN0cmVhbXNbaV0uc3RhdHMubG9jID09ICIiCiAgICAgICAgICAgICAgICB8fCBkYXRhLnN0cmVhbXNbaV0udGl0bGUgPT0gIiIKICAgICAgICAgICAgICAgIHx8IGRhdGEuc3RyZWFtc1tpXS5pbWFnZXNbJzEyOHgxMjgnXSA9PSAiIgogICAgICAgICAgICAgICAgfHwgZGF0YS5zdHJlYW1zW2ldLnNvdXJjZXNbJ21wMzEyOHdlYiddID09ICIiCiAgICAgICAgICAgICAgICB8fCBkYXRhLnN0cmVhbXNbaV0ucHJvZ3JhbSA9PSAiIikgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNoYW5uZWxzLnB1c2goewogICAgICAgICAgICAgICAgbmFtZTogZGF0YS5zdHJlYW1zW2ldLnN0YXRzLndlYnBsYXllcl9pZCwKICAgICAgICAgICAgICAgIGludGVybmFsOiBkYXRhLnN0cmVhbXNbaV0uc3RhdHMubG9jLAogICAgICAgICAgICAgICAgdGl0bGU6IGRhdGEuc3RyZWFtc1tpXS50aXRsZSwKICAgICAgICAgICAgICAgIGNvdmVyOiBkYXRhLnN0cmVhbXNbaV0uaW1hZ2VzWycxMjh4MTI4J10sCiAgICAgICAgICAgICAgICBzdHJlYW1zOiBkYXRhLnN0cmVhbXNbaV0uc291cmNlcywKICAgICAgICAgICAgICAgIHByb2dyYW06IGRhdGEuc3RyZWFtc1tpXS5wcm9ncmFtLnJlcGxhY2UoJ2h0dHA6JywgJ2h0dHBzOicpCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gc2hvdyBjaGFubmVsIGxpc3QKICAgICAgICAkLnRtcGwoIlRwbENoYW5uZWwiLCBjaGFubmVscykuYXBwZW5kVG8oIiNjaGFubmVsc3Njcm9sbGVyIHVsIik7CgogICAgICAgIC8vIGNsaWNrIGEgY2hhbm5lbCBsb2dvIHRvIHNob3cgY2hhbm5lbCBpbmZvcyBhbmQgcGxheQogICAgICAgICQoJyNjaGFubmVsc3Njcm9sbGVyIGEnKS5jbGljayhmdW5jdGlvbihlKXsKICAgICAgICAgICAgdmFyIGNoYW5uZWwgPSAkKHRoaXMpLmF0dHIoJ3JlbCcpOwogICAgICAgICAgICBpZiAobG9jYXRpb24uaGFzaCA9PSAnIycgKyBjaGFubmVsICsgJy9wbGF5JykgewogICAgICAgICAgICAgICAgc3dpdGNoQ2hhbm5lbChjaGFubmVsKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyBjbGljayB0aGUgY2hhbm5lbCBsb2dvIHRvIGhpZGUgaXQKICAgICAgICAkKCcjY2hhbmluZm8tY292ZXInKS5jbGljayhmdW5jdGlvbihlKXsKICAgICAgICAgICAgaGlkZUNoYW5JbmZvKCk7CiAgICAgICAgfSk7CgogICAgICAgIC8vIHNsaWRlIGNoYW5uZWwgbGlzdCBzaWRld2F5cyB1c2luZyBhcnJvdyBidXR0b25zCgogICAgICAgICQoJyNjaGFubGVmdCcpLmNsaWNrKGZ1bmN0aW9uKGUpewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGNoYW5zbGlkZSgnbGVmdCcpOwogICAgICAgIH0pOwogICAgICAgICQoJyNjaGFucmlnaHQnKS5jbGljayhmdW5jdGlvbihlKXsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjaGFuc2xpZGUoJ3JpZ2h0Jyk7CiAgICAgICAgfSk7CgogICAgICAgIC8vIGNsaWNrIHBsYXkvc3RvcCBidXR0b24KICAgICAgICAkKCcjY29udHJvbHMtcGxheScpLmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZhciBoYXNoID0gJyMnICsgJCgiI2NoYW5uZWxzIikuZmluZCgiYS5hY3RpdmUiKS5hdHRyKCdyZWwnKTsKICAgICAgICAgICAgaWYgKCQoJyNjb250cm9scy1wbGF5JykuaGFzQ2xhc3MoInN0b3AiKSkgewogICAgICAgICAgICAgICAgbG9jYXRpb24uaGFzaCA9IGhhc2ggKyAnL3BsYXknOwogICAgICAgICAgICAgICAgaWYgKG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL21vYmlsZS9pKSkgewogICAgICAgICAgICAgICAgICAgIHBsYXkodHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsb2NhdGlvbi5oYXNoID0gaGFzaDsKICAgICAgICAgICAgICAgIGlmIChuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9tb2JpbGUvaSkpIHsKICAgICAgICAgICAgICAgICAgICBwbGF5KGZhbHNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyBjbGljayBwcmV2aW91cy9uZXh0IGJ1dHRvbiB0byBzd2l0Y2ggdG8gb3RoZXIgY2hhbm5lbAogICAgICAgICQoJyNjb250cm9scy1wcmV2JykuY2xpY2soZnVuY3Rpb24oZSl7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgbmV4dENoYW5uZWwoJ3ByZXYnKTsKICAgICAgICB9KTsKICAgICAgICAkKCcjY29udHJvbHMtbmV4dCcpLmNsaWNrKGZ1bmN0aW9uKGUpewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIG5leHRDaGFubmVsKCduZXh0Jyk7CiAgICAgICAgfSk7CgogICAgICAgIC8vIHNldCB2b2x1bWUgY29udHJvbCwgaW5pdGlhbCA2MCUKICAgICAgICB2b2x1bWVTbGlkZXIoJCgnI3ZvbHVtZScpLCA2MCwgZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgJCgiI2pQbGF5ZXIiKS5qUGxheWVyKCd2b2x1bWUnLCB2YWx1ZSAvIDEwMCk7CiAgICAgICAgfSk7CgogICAgICAgIC8vIHRvZ2dsZSBzdHJlYW0gcXVhbGl0eSBvbiBjbGljawogICAgICAgICQoJyNxdWFsaXR5IGEnKS5jbGljayhmdW5jdGlvbihlKXsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB2YXIgZWwgPSAkKHRoaXMpOwogICAgICAgICAgICB2YXIgdmFsdWUgPSBlbC5hdHRyKCdyZWwnKTsKICAgICAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhxdWFsaXRpZXMpOwogICAgICAgICAgICB2YXIgcG9zID0ga2V5cy5pbmRleE9mKHZhbHVlKTsKICAgICAgICAgICAgdmFyIG5ld3BvcyA9IDE7IC8vIGRlZmF1bHQgPSAxMjgKICAgICAgICAgICAgaWYgKHBvcyA+PSAwKSB7CiAgICAgICAgICAgICAgICBuZXdwb3MgPSAocG9zICsgMSkgJSBrZXlzLmxlbmd0aDsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXRRdWFsaXR5KGtleXNbbmV3cG9zXSk7CiAgICAgICAgICAgIGlmKGxvY2F0aW9uLmhhc2gubGVuZ3RoID4gMSAmJiAvXC9wbGF5JC8udGVzdChsb2NhdGlvbi5oYXNoKSkgewogICAgICAgICAgICAgICAgcGxheSh0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyByZWFkIHF1YWxpdHkgc2V0dGluZyBmcm9tIHVzZXIgY29va2llCiAgICAgICAgdmFyIGtleXZhbHVlID0gZG9jdW1lbnQuY29va2llLm1hdGNoKCcoXnw7KSA/c3RyZWFtcXVhbGl0eT0oW147XSopKDt8JCknKTsKICAgICAgICBpZiAoa2V5dmFsdWUgJiYgcXVhbGl0aWVzW2tleXZhbHVlWzJdXSAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgc2V0UXVhbGl0eShrZXl2YWx1ZVsyXSk7CiAgICAgICAgfQoKICAgICAgICAvLyBzZXR1cCBuZXdzIGZlZWQKICAgICAgICAvL2xvYWRSU1NmZWVkKCcvZmVlZC8nKTsKCiAgICAgICAgLy8gaW5pdGlhbGl6ZSBwbGF5ZXIgYW5kIGNob29zZSBjaGFubmVsCiAgICAgICAgaW5pdFBsYXllcigpOwogICAgICAgIHJlc3RhcnRQbGF5bGlzdCgpOwoKICAgICAgICAvLyBsaXN0ZW4gZm9yIGhhc2ggdGFnOyBjaGFubmVsIHN3aXRjaGluZyBhbmQgcGxheS9zdG9wIHdvcmtzIHRoaXMgd2F5IQogICAgICAgICQod2luZG93KS5vbignaGFzaGNoYW5nZScsIGluaXRQbGF5ZXIpOwoKICAgIH0pCiAgICAgICAgLmZhaWwoZnVuY3Rpb24oKXsKCiAgICAgICAgfSk7CgoKCiAgICAvLyBzbGlkZSBjaGFubmVsIGxpc3Qgc2lkZXdheXMgdXNpbmcgc2Nyb2xsTGVmdAogICAgZnVuY3Rpb24gY2hhbnNsaWRlKGRpcmVjdGlvbikgewogICAgICAgIGlmIChjaGFuSXNTbGlkaW5nKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY2hhbklzU2xpZGluZyA9IHRydWU7CiAgICAgICAgdmFyIGNoYW5saXN0ID0gJCgnI2NoYW5uZWxzc2Nyb2xsZXInKTsKICAgICAgICB2YXIgbGVmdCA9IGNoYW5saXN0LnNjcm9sbExlZnQoKTsKICAgICAgICAvLyByZWFjaGVkIHRoZSBlbmQ/IChuZWVkIHRvIGNoZWNrIGl0IGluIEZpcmVmb3gpCiAgICAgICAgLy9pZiAoZGlyZWN0aW9uID09ICdyaWdodCcgJiYgKGNoYW5uZWxzLmxlbmd0aCAtIDMpICogOTAgPD0gbGVmdCkgewogICAgICAgIC8vCWNoYW5Jc1NsaWRpbmcgPSBmYWxzZTsKICAgICAgICAvLwlyZXR1cm47CiAgICAgICAgLy99CiAgICAgICAgdmFyIHJlbWFpbmRlciA9IGxlZnQgJSA5MDsKICAgICAgICBpZiAoZGlyZWN0aW9uID09ICdsZWZ0JykgewogICAgICAgICAgICBpZiAocmVtYWluZGVyID4gMCkgewogICAgICAgICAgICAgICAgbGVmdCA9IGxlZnQgLSByZW1haW5kZXI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsZWZ0IC09IDkwOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHJlbWFpbmRlciA+IDApIHsKICAgICAgICAgICAgICAgIGxlZnQgPSBsZWZ0ICsgOTAgLSByZW1haW5kZXI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsZWZ0ICs9IDkwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNoYW5saXN0LmFuaW1hdGUoewogICAgICAgICAgICBzY3JvbGxMZWZ0OiBsZWZ0CiAgICAgICAgfSwgMTAwLCAnc3dpbmcnLCBmdW5jdGlvbigpewogICAgICAgICAgICBjaGFuSXNTbGlkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gaWYgYSBjaGFubmVsIGlzbid0IGluIHZpZXcsIHNjcm9sbCB0byBpdAogICAgZnVuY3Rpb24gc2Nyb2xsVG9DaGFubmVsKGNoYW5uZWwsIGNhbGxiYWNrKSB7CiAgICAgICAgaWYgKGNoYW5Jc1NsaWRpbmcpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjaGFuSXNTbGlkaW5nID0gdHJ1ZTsKICAgICAgICB2YXIgY2hhbmxpc3QgPSAkKCcjY2hhbm5lbHNzY3JvbGxlcicpOwogICAgICAgIHZhciBjaGFuID0gJCgnI2NoYW5uZWxzJykuZmluZCgnW3JlbD0iJytjaGFubmVsKyciXScpOwogICAgICAgIHZhciBsZWZ0ID0gY2hhbi5vZmZzZXQoKS5sZWZ0IC0gY2hhbmxpc3Qub2Zmc2V0KCkubGVmdDsKICAgICAgICB2YXIgcmlnaHQgPSBjaGFuLm9mZnNldCgpLmxlZnQgLSBjaGFubGlzdC5vZmZzZXQoKS5sZWZ0ICsgOTAgLSBjaGFubGlzdC53aWR0aCgpOwogICAgICAgIHZhciBzY3JvbGxsZWZ0ID0gMDsKICAgICAgICBpZiAobGVmdCA8PSAwKSB7CiAgICAgICAgICAgIC8vIGxvZ28gaXN0IG5pY2h0IHNpY2h0YmFyLCBzaWNodGJhciBtYWNoZW4KICAgICAgICAgICAgc2Nyb2xsbGVmdCA9IGNoYW5saXN0LnNjcm9sbExlZnQoKSArIGxlZnQ7CiAgICAgICAgfSBlbHNlIGlmIChyaWdodCA+IDApIHsKICAgICAgICAgICAgc2Nyb2xsbGVmdCA9IGNoYW5saXN0LnNjcm9sbExlZnQoKSArIHJpZ2h0OwogICAgICAgIH0KICAgICAgICBpZiAobGVmdCA8PSAwIHx8IHJpZ2h0ID4gMCkgewogICAgICAgICAgICBjaGFubGlzdC5hbmltYXRlKHsKICAgICAgICAgICAgICAgIHNjcm9sbExlZnQ6IHNjcm9sbGxlZnQKICAgICAgICAgICAgfSwgMTAwLCAnc3dpbmcnLCBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICAgICAgICAgIGNoYW5Jc1NsaWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmKGNhbGxiYWNrICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjYWxsYmFjaygpOwogICAgICAgICAgICBjaGFuSXNTbGlkaW5nID0gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8vIGhpZGUgY2hhbm5lbCBpbmZvCiAgICBmdW5jdGlvbiBoaWRlQ2hhbkluZm8oY2FsbGJhY2spIHsKICAgICAgICB2YXIgbGVmdCA9ICQoJyNjaGFuaW5mby1jb3ZlcicpLmF0dHIoJ2RhdGEtbGVmdCcpOwogICAgICAgIHZhciBjb3ZlciA9ICQoJyNjaGFuaW5mby1jb3ZlciBpbWcnKS5hdHRyKCdzcmMnKTsKICAgICAgICBpZiAobGVmdCA9PSAwKSB7CiAgICAgICAgICAgICQoJyNjaGFuaW5mbycpLmhpZGUoKTsKICAgICAgICAgICAgJCgnI2NoYW5zZWxlY3RvcicpLnNob3coKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgbG9nbyA9ICQoJyNjaGFubG9nbycpCiAgICAgICAgICAgICAgICAuYXR0cignc3JjJywgY292ZXIpCiAgICAgICAgICAgICAgICAuY3NzKCdsZWZ0JywgMCkKICAgICAgICAgICAgICAgIC5zaG93KCk7CiAgICAgICAgICAgICQoJyNjaGFuaW5mbycpLmZhZGVPdXQoMTAwKTsKICAgICAgICAgICAgbG9nby5hbmltYXRlKHsKICAgICAgICAgICAgICAgIGxlZnQ6IChsZWZ0LTI1KSsncHgnCiAgICAgICAgICAgIH0sIDIwMCwgJ3N3aW5nJywgZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICQoJyNjaGFuc2VsZWN0b3InKS5mYWRlSW4oMTAwLCBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgIGxvZ28uaGlkZSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIHN3aXRjaCB0byBhbm90aGVyIGNoYW5uZWw7IGluY2x1ZGVzIGFuaW1hdGlvbnMKICAgIGZ1bmN0aW9uIHN3aXRjaENoYW5uZWwoY2hhbm5lbCwgY2FsbGJhY2spIHsKICAgICAgICBpZiAoY2hhbklzQW5pbWF0aW5nKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY2hhbklzQW5pbWF0aW5nID0gdHJ1ZTsKICAgICAgICB2YXIgY2hhbiA9ICQoJyNjaGFubmVsc3Njcm9sbGVyIGEuYWN0aXZlJyk7CiAgICAgICAgdmFyIGNoYW5pbmZvID0gJCgnI2NoYW5pbmZvJyk7CiAgICAgICAgaWYgKGNoYW4uYXR0cigncmVsJykgPT0gY2hhbm5lbCAmJiBjaGFuaW5mby5pcygnOnZpc2libGUnKSkgewogICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjaygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNoYW5Jc0FuaW1hdGluZyA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHZhciBjaGFuc2VsZWN0b3IgPSAkKCcjY2hhbnNlbGVjdG9yJyk7CgogICAgICAgIGlmIChjaGFuaW5mby5pcygnOnZpc2libGUnKSkgewogICAgICAgICAgICBoaWRlQ2hhbkluZm8oZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHNjcm9sbFRvQ2hhbm5lbChjaGFubmVsLCBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgIHNldENoYW5uZWxBY3RpdmUoY2hhbm5lbCk7CiAgICAgICAgICAgICAgICAgICAgc2hvd0NoYW5JbmZvKGNoYW5uZWwsIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY2hhbklzQW5pbWF0aW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2Nyb2xsVG9DaGFubmVsKGNoYW5uZWwsIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICBzZXRDaGFubmVsQWN0aXZlKGNoYW5uZWwpOwogICAgICAgICAgICAgICAgc2hvd0NoYW5JbmZvKGNoYW5uZWwsIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjaGFuSXNBbmltYXRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CgogICAgLy8gc2V0cyBhIGNoYW5uZWwgYWN0aXZlCiAgICBmdW5jdGlvbiBzZXRDaGFubmVsQWN0aXZlKGNoYW5uZWwpIHsKICAgICAgICAkKCcjY2hhbm5lbHNzY3JvbGxlciBhLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgICAkKCcjY2hhbm5lbHMnKS5maW5kKCdbcmVsPSInK2NoYW5uZWwrJyJdJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOwogICAgfQoKICAgIC8vIHNob3dzIGNoYW5uZWwgaW5mb3MKICAgIGZ1bmN0aW9uIHNob3dDaGFuSW5mbyhjaGFubmVsLCBjYWxsYmFjaykgewogICAgICAgIHZhciBjaGFuaW5mbyA9IGdldENoYW5JbmZvKGNoYW5uZWwpOwogICAgICAgIHZhciBjaGFuID0gJCgnI2NoYW5uZWxzJykuZmluZCgnW3JlbD0iJytjaGFubmVsKyciXScpOwogICAgICAgIHZhciBwb3NMZWZ0ID0gY2hhbi5wcm9wKCdvZmZzZXRMZWZ0JykgLSAkKCcjY2hhbm5lbHNzY3JvbGxlcicpLnNjcm9sbExlZnQoKTsKCiAgICAgICAgc2V0Q2hhbkluZm8oY2hhbmluZm8sIHBvc0xlZnQgKyAyNSk7CgogICAgICAgIHZhciBsb2dvID0gJCgnI2NoYW5sb2dvJyk7CiAgICAgICAgbG9nbwogICAgICAgICAgICAuYXR0cignc3JjJywgY2hhbmluZm8uY292ZXIucmVwbGFjZSgnaHR0cDonLCAnaHR0cHM6JykpCiAgICAgICAgICAgIC5jc3MoJ2xlZnQnLCAocG9zTGVmdCkgKyAncHgnKQogICAgICAgICAgICAuc2hvdygpOwoKICAgICAgICAkKCcjY2hhbnNlbGVjdG9yJykuZmFkZU91dCgxMDAsIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICQodGhpcykuaGlkZSgpOwogICAgICAgIH0pOwogICAgICAgIGxvZ28uYW5pbWF0ZSh7CiAgICAgICAgICAgIGxlZnQ6IDAKICAgICAgICB9LCAyMDAsICdzd2luZycsIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICQoJyNjaGFuaW5mbycpLmZhZGVJbigxMDAsIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICBsb2dvLmhpZGUoKTsKICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvLyBzd2l0Y2hlcyB0byBwcmV2aW91cyBvciBuZXh0IGNoYW5uZWwKICAgIGZ1bmN0aW9uIG5leHRDaGFubmVsKGRpcmVjdGlvbikgewogICAgICAgIGlmIChjaGFuSXNBbmltYXRpbmcpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgZWwgPSAkKCcjY2hhbm5lbHMnKS5maW5kKCdhLmFjdGl2ZScpLnBhcmVudCgpOwogICAgICAgIGlmIChkaXJlY3Rpb24gPT0gJ3ByZXYnKSB7CiAgICAgICAgICAgIGVsID0gZWwucHJldigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVsID0gZWwubmV4dCgpOwogICAgICAgIH0KICAgICAgICBlbCA9IGVsLmZpbmQoJ2EnKTsKICAgICAgICBpZiAoZWwubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgY2hhbm5lbCA9IGVsLmF0dHIoJ3JlbCcpOwogICAgICAgIHZhciBoYXNoID0gJyMnICsgY2hhbm5lbDsKICAgICAgICBpZiAoL1wvcGxheSQvLnRlc3QobG9jYXRpb24uaGFzaCkpIHsKICAgICAgICAgICAgaGFzaCArPSAnL3BsYXknOwogICAgICAgICAgICBpZiAobmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvbW9iaWxlL2kpKSB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgcGxheSh0cnVlKTsKICAgICAgICAgICAgICAgIH0sIDMxMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbG9jYXRpb24uaGFzaCA9IGhhc2g7CiAgICB9CgogICAgLy8gc3RhcnQgb3Igc3RvcCBwbGF5YmFjawogICAgZnVuY3Rpb24gcGxheShwbGF5KSB7CiAgICAgICAgaWYgKHBsYXkgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZigkKCIjY29udHJvbHMtcGxheSIpLmhhc0NsYXNzKCJzdG9wIikpIHsKICAgICAgICAgICAgICAgIHBsYXkgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcGxheSA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChwbGF5KSB7CiAgICAgICAgICAgIHZhciBjaGFubmVsID0gJCgnI2NoYW5uZWxzc2Nyb2xsZXIgYS5hY3RpdmUnKS5hdHRyKCdyZWwnKTsKICAgICAgICAgICAgdmFyIGNoYW5pbmZvID0gZ2V0Q2hhbkluZm8oY2hhbm5lbCk7CiAgICAgICAgICAgIHZhciBtZWRpYSA9IHsgbXAzOiBjaGFuaW5mby5zdHJlYW1zW3F1YWxpdHldLnJlcGxhY2UoJ2h0dHA6JywgJ2h0dHBzOicpIH07CiAgICAgICAgICAgIC8vaWYgKC9hYWMvaS50ZXN0KGNoYW5pbmZvLnN0cmVhbXNbcXVhbGl0eV0pKSB7CiAgICAgICAgICAgIC8vCW1lZGlhID0geyBtcDM6IGNoYW5pbmZvLnN0cmVhbXNbcXVhbGl0eV0gfTsKICAgICAgICAgICAgLy99CgogICAgICAgICAgICAkKCIjalBsYXllciIpCiAgICAgICAgICAgICAgICAualBsYXllcigic2V0TWVkaWEiLCBtZWRpYSkKICAgICAgICAgICAgICAgIC5qUGxheWVyKCdwbGF5Jyk7CiAgICAgICAgICAgICQoIiNjb250cm9scy1wbGF5IikKICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygnc3RvcCcpCiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ3BsYXknKQogICAgICAgICAgICAgICAgLmZpbmQoJ2ltZycpCiAgICAgICAgICAgICAgICAuYXR0cignc3JjJywgJ2ltYWdlcy9zdG9wLnBuZycpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQoIiNqUGxheWVyIikualBsYXllcignY2xlYXJNZWRpYScpOwogICAgICAgICAgICAkKCIjY29udHJvbHMtcGxheSIpCiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ3BsYXknKQogICAgICAgICAgICAgICAgLmFkZENsYXNzKCdzdG9wJykKICAgICAgICAgICAgICAgIC5maW5kKCdpbWcnKQogICAgICAgICAgICAgICAgLmF0dHIoJ3NyYycsICdpbWFnZXMvcGxheS5wbmcnKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc2V0UXVhbGl0eSh2YWx1ZSkgewogICAgICAgIC8vdmFyIGNoYW5uZWwgPSAkKCcjY2hhbm5lbHNzY3JvbGxlciBhLmFjdGl2ZScpLmF0dHIoJ3JlbCcpOwogICAgICAgIC8vaWYgKHR5cGVvZiBjaGFubmVsICE9PSAnc3RyaW5nJykgewogICAgICAgIC8vCXJldHVybjsKICAgICAgICAvL30KICAgICAgICAvL3ZhciBjaGFuaW5mbyA9IGdldENoYW5JbmZvKGNoYW5uZWwpOwogICAgICAgIC8vaWYgKGNoYW5pbmZvLnN0cmVhbXNbdmFsdWVdID09IHVuZGVmaW5lZCkgewogICAgICAgIC8vCXJldHVybjsKICAgICAgICAvL30KICAgICAgICBpZiAocXVhbGl0aWVzW3ZhbHVlXSA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBxdWFsaXR5ID0gdmFsdWU7CgogICAgICAgICQoJyNxdWFsaXR5IGEnKQogICAgICAgICAgICAuYXR0cigncmVsJywgdmFsdWUpCiAgICAgICAgICAgIC50ZXh0KHF1YWxpdGllc1t2YWx1ZV0pOwoKICAgICAgICAvLyBzZXQgcXVhbGl0eSBzZXR0aW5nIGNvb2tpZQogICAgICAgIHZhciBleHBpcmVzID0gbmV3IERhdGUoKTsKICAgICAgICBleHBpcmVzLnNldFRpbWUoZXhwaXJlcy5nZXRUaW1lKCkgKyAoMSAqIDI0ICogNjAgKiA2MCAqIDEwMDApKTsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAnc3RyZWFtcXVhbGl0eT0nICsgcXVhbGl0eSArICc7cGF0aD0vc3RyZWFtLztleHBpcmVzPScgKyBleHBpcmVzLnRvVVRDU3RyaW5nKCk7CiAgICB9CgogICAgLy8gc2V0dXAgY2hhbm5lbDsgZmlyZWQgb24gZXZlcnkgaGFzaCBjaGFuZ2UKICAgIGZ1bmN0aW9uIGluaXRQbGF5ZXIoKSB7CiAgICAgICAgaWYobG9jYXRpb24uaGFzaC5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIHZhciBwYXJhbXMgPSBsb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKS5zcGxpdCgiLyIpOwogICAgICAgICAgICBpZiAoZ2V0Q2hhbkluZm8ocGFyYW1zWzBdKSA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgc2V0Q2hhbm5lbEFjdGl2ZShjaGFubmVsc1swXS5uYW1lKTsKICAgICAgICAgICAgICAgIHNldFN0YXRpb24oY2hhbm5lbHNbMF0ubmFtZSk7CiAgICAgICAgICAgICAgICBwbGF5KGZhbHNlKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzd2l0Y2hDaGFubmVsKHBhcmFtc1swXSwgZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHNldFN0YXRpb24ocGFyYW1zWzBdKTsKICAgICAgICAgICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID4gMSAmJiBwYXJhbXNbMV0gPT0gJ3BsYXknKSB7CiAgICAgICAgICAgICAgICAgICAgcGxheSh0cnVlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcGxheShmYWxzZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNldENoYW5uZWxBY3RpdmUoY2hhbm5lbHNbMF0ubmFtZSk7CiAgICAgICAgICAgIHNldFN0YXRpb24oY2hhbm5lbHNbMF0ubmFtZSk7CiAgICAgICAgICAgIHBsYXkoZmFsc2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBnZXRzIGNoYW5uZWwgaW5mbwogICAgZnVuY3Rpb24gZ2V0Q2hhbkluZm8oY2hhbm5lbCkgewogICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBjaGFubmVscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoY2hhbm5lbHNbaV0ubmFtZSA9PSBjaGFubmVsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2hhbm5lbHNbaV07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIHNldHMgY2hhbm5lbCBpbmZvIGRpYWxvZwogICAgZnVuY3Rpb24gc2V0Q2hhbkluZm8oY2hhbmluZm8sIHBvcykgewoKICAgICAgICAkKCcjY2hhbmluZm8tY292ZXIgaW1nJykuYXR0cignc3JjJywgY2hhbmluZm8uY292ZXIucmVwbGFjZSgnaHR0cDonLCAnaHR0cHM6JykpOwogICAgICAgICQoJyNjaGFuaW5mby1jb3ZlcicpLmF0dHIoJ2RhdGEtbGVmdCcsIHBvcyk7CgogICAgICAgIC8qJC5nZXRKU09OKGNoYW5pbmZvLnByb2dyYW0ucmVwbGFjZSgiaHR0cDoiLCJodHRwczoiKSkuZG9uZShmdW5jdGlvbihkYXRhKXsKICAgICAgICAgICAgdmFyIGZvdW5kID0gZmFsc2U7CiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBkYXRhLnByb2dyYW0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhLnByb2dyYW1baV0uc3RhcnRfdGltZXN0YW1wIDwgZGF0YS5ub3dfdGltZXN0YW1wICYmIGRhdGEucHJvZ3JhbVtpXS5lbmRfdGltZXN0YW1wID4gZGF0YS5ub3dfdGltZXN0YW1wKSB7CiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICQoJyNjaGFuaW5mby10aW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQoZGF0YS5wcm9ncmFtW2ldLnN0YXJ0X3RpbWUgKyAiLSIgKyBkYXRhLnByb2dyYW1baV0uZW5kX3RpbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCJ0aXRsZSIsIGRhdGEucHJvZ3JhbVtpXS5zdGFydF90aW1lICsgIi0iICsgZGF0YS5wcm9ncmFtW2ldLmVuZF90aW1lKTsKICAgICAgICAgICAgICAgICAgICAkKCcjY2hhbmluZm8tdGl0bGUnKQogICAgICAgICAgICAgICAgICAgICAgICAudGV4dChkYXRhLnByb2dyYW1baV0udGl0bGUpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCJ0aXRsZSIsIGRhdGEucHJvZ3JhbVtpXS50aXRsZSk7CiAgICAgICAgICAgICAgICAgICAgJCgnI2NoYW5pbmZvLWRlc2MnKQogICAgICAgICAgICAgICAgICAgICAgICAudGV4dChkYXRhLnByb2dyYW1baV0uZXhjZXJwdCkKICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoInRpdGxlIiwgZGF0YS5wcm9ncmFtW2ldLmV4Y2VycHQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgICAgICAgICQoJyNjaGFuaW5mby10aW1lJykKICAgICAgICAgICAgICAgICAgICAudGV4dCgiIikKICAgICAgICAgICAgICAgICAgICAuYXR0cigidGl0bGUiLCAiIik7CiAgICAgICAgICAgICAgICAkKCcjY2hhbmluZm8tdGl0bGUnKQogICAgICAgICAgICAgICAgICAgIC50ZXh0KCIiKQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJ0aXRsZSIsICIiKTsKICAgICAgICAgICAgICAgICQoJyNjaGFuaW5mby1kZXNjJykKICAgICAgICAgICAgICAgICAgICAudGV4dCgiIikKICAgICAgICAgICAgICAgICAgICAuYXR0cigidGl0bGUiLCAiIik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsqLwoKICAgIH0KCiAgICAvLyBzdHJlYW0gYW5kIHVwZGF0ZSBwbGF5bGlzdAogICAgZnVuY3Rpb24gc2V0U3RhdGlvbihzdGF0aW9uKSB7CiAgICAgICAgdmFyIGNoYW5pbmZvID0gZ2V0Q2hhbkluZm8oc3RhdGlvbik7CiAgICAgICAgLy8kKCcjalBsYXllcicpLmpQbGF5ZXIoJ3NldE1lZGlhJywgewogICAgICAgIC8vCW1wMzogY2hhbmluZm8uc3RyZWFtc1txdWFsaXR5XQogICAgICAgIC8vfSk7CiAgICAgICAgJCgnI3BsdGl0bGUnKS50ZXh0KGNoYW5pbmZvLnRpdGxlICsgIiAtIFp1bGV0enQgZ2VzcGllbHQiKTsKICAgICAgICByZXN0YXJ0UGxheWxpc3QoKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZXN0YXJ0UGxheWxpc3QoKSB7CiAgICAgICAgY2xlYXJJbnRlcnZhbChwbGF5bGlzdEludGVydmFsKTsKICAgICAgICB1cGRhdGVQbGF5bGlzdCgpOwogICAgICAgIHBsYXlsaXN0SW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh1cGRhdGVQbGF5bGlzdCwgMzAwMDApOwogICAgfQogICAgLy8gbG9hZHMgcGxheWxpc3QgZGF0YQogICAgLy8gd2hpdGU6IGh0dHA6Ly9lY3guaW1hZ2VzLWFtYXpvbi5jb20vaW1hZ2VzL0kvNjFFNks4TUlxT0wuX1NMMzIwXy5qcGcKICAgIGZ1bmN0aW9uIHVwZGF0ZVBsYXlsaXN0KCkgewogICAgICAgIHZhciBjaGFubmVsID0gJCgnI2NoYW5uZWxzc2Nyb2xsZXIgYS5hY3RpdmUnKS5hdHRyKCdyZWwnKTsKICAgICAgICBpZiAodHlwZW9mIGNoYW5uZWwgIT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIGNoYW5pbmZvID0gZ2V0Q2hhbkluZm8oY2hhbm5lbCk7CiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJywKICAgICAgICAgICAgdXJsOiBwbGF5bGlzdCArICcmbG9jPScgKyBjaGFuaW5mby5pbnRlcm5hbCArICcmY3V0dGltZT0xJmxpbWl0PTQnLAogICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXMgIT0gIm9rIikgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICQoJyN0cmFjay1hcnRpc3QnKS50ZXh0KGRhdGEudHJhY2tzWzBdLmFydGlzdCk7CiAgICAgICAgICAgICAgICAkKCcjdHJhY2stdGl0bGUnKS50ZXh0KGRhdGEudHJhY2tzWzBdLnRpdGxlKTsKICAgICAgICAgICAgICAgICQoJyN0cmFjay1hbGJ1bScpLnRleHQoZGF0YS50cmFja3NbMF0uYWxidW0pOwogICAgICAgICAgICAgICAgaWYgKGRhdGEudHJhY2tzWzBdLmNvdmVydXJsID09ICIiIHx8IGRhdGEudHJhY2tzWzBdLmNvdmVydXJsID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAkKCcjY292ZXInKS5hdHRyKCdzcmMnLCAiaW1hZ2VzL2NvdmVyLnBuZyIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NvdmVyJykuYXR0cignc3JjJywgZGF0YS50cmFja3NbMF0uY292ZXJ1cmwucmVwbGFjZSgvU0w3NV9cLmpwZyQvLCAnU0wzMjBfLmpwZycpKTsKCgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJCgiI3BsaXN0IikuaHRtbCgiIik7CiAgICAgICAgICAgICAgICAkLnRtcGwoIlRwbFBsYXlsaXN0IiwgZGF0YS50cmFja3MpLmFwcGVuZFRvKCIjcGxsaXN0Iik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICAvLyBzZXR1cCB2b2x1bWUgc2xpZGVyCiAgICBmdW5jdGlvbiB2b2x1bWVTbGlkZXIoc2xpZGVyLCBkZWZhdWx0VmFsdWUsIG9uRHJhZykgewoKICAgICAgICB2YXIgZHJhZ2dlciA9IHNsaWRlci5jaGlsZHJlbigpOwogICAgICAgIHZhciBkcmFnZ2VyV2lkdGggPSA0OwogICAgICAgIHZhciBkb3duID0gZmFsc2U7CiAgICAgICAgdmFyIHJhbmdlV2lkdGgsIHJhbmdlTGVmdDsKCiAgICAgICAgZHJhZ2dlci5jc3MoJ3dpZHRoJywgZHJhZ2dlcldpZHRoICsgJ3B4Jyk7CiAgICAgICAgZHJhZ2dlci5jc3MoJ2xlZnQnLCAoLWRyYWdnZXJXaWR0aCArIHNsaWRlci53aWR0aCgpICogZGVmYXVsdFZhbHVlIC8gMTAwKSArICdweCcpOwogICAgICAgIGRyYWdnZXIuY3NzKCdtYXJnaW4tbGVmdCcsIChkcmFnZ2VyV2lkdGggLyAyKSArICdweCcpOwoKICAgICAgICBzbGlkZXIubW91c2Vkb3duKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICByYW5nZVdpZHRoID0gdGhpcy5vZmZzZXRXaWR0aDsKICAgICAgICAgICAgcmFuZ2VMZWZ0ID0gdGhpcy5vZmZzZXRMZWZ0OwogICAgICAgICAgICBkb3duID0gdHJ1ZTsKICAgICAgICAgICAgdXBkYXRlRHJhZ2dlcihlKTsKICAgICAgICB9KTsKCiAgICAgICAgJChkb2N1bWVudCkubW91c2Vtb3ZlKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdXBkYXRlRHJhZ2dlcihlKTsKICAgICAgICB9KTsKCiAgICAgICAgJChkb2N1bWVudCkubW91c2V1cChmdW5jdGlvbigpIHsKICAgICAgICAgICAgZG93biA9IGZhbHNlOwogICAgICAgIH0pOwoKICAgICAgICBmdW5jdGlvbiB1cGRhdGVEcmFnZ2VyKGUpIHsKICAgICAgICAgICAgaWYgKGRvd24gJiYgZS5wYWdlWCA+PSByYW5nZUxlZnQgJiYgZS5wYWdlWCA8PSAocmFuZ2VMZWZ0ICsgcmFuZ2VXaWR0aCkpIHsKICAgICAgICAgICAgICAgIGRyYWdnZXIuY3NzKCdsZWZ0JywgZS5wYWdlWCAtIHJhbmdlTGVmdCAtIGRyYWdnZXJXaWR0aCArICdweCcpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvbkRyYWcgPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgICAgIG9uRHJhZyhNYXRoLnJvdW5kKCgoZS5wYWdlWCAtIHJhbmdlTGVmdCkgLyByYW5nZVdpZHRoKSAqIDEwMCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KCiAgICAvLyBSU1MgZmVlZAogICAgLyoKICAgIGZ1bmN0aW9uIGxvYWRSU1NmZWVkKHJzc3VybCkgewogICAgICAgICQuZ2V0KHJzc3VybCwgZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICB2YXIgJHhtbCA9ICQoZGF0YSk7CiAgICAgICAgICAgIHZhciBpdGVtcyA9IFtdOwogICAgICAgICAgICB2YXIgaSA9IDA7CiAgICAgICAgICAgICR4bWwuZmluZCgiaXRlbSIpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpZiAoaSsrPDUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpOwogICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICR0aGlzLmZpbmQoInRpdGxlIikudGV4dCgpLAogICAgICAgICAgICAgICAgICAgIGxpbms6ICR0aGlzLmZpbmQoImxpbmsiKS50ZXh0KCksCiAgICAgICAgICAgICAgICAgICAgY29udGVudFNuaXBwZXQ6ICR0aGlzLmZpbmQoImRlc2NyaXB0aW9uIikudGV4dCgpLnJlcGxhY2UoLzxpbWcuKj8+LywgJycpLAogICAgICAgICAgICAgICAgICAgIC8vcHViRGF0ZTogJHRoaXMuZmluZCgicHViRGF0ZSIpLnRleHQoKSwKICAgICAgICAgICAgICAgICAgICAvL2F1dGhvcjogJHRoaXMuZmluZCgiYXV0aG9yIikudGV4dCgpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgaXRlbXMucHVzaChpdGVtKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICQudG1wbCgiVHBsTmV3cyIsIGl0ZW1zKS5wcmVwZW5kVG8oIiNuZXdzbGlzdCIpOwogICAgICAgIH0pOwogICAgfQogICAgKi8KCn0pOwo=';




